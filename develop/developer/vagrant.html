
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Vagrant &#8212; bodhi 7.1.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Debugging with Visual Studio Code" href="vagrant_vscode.html" />
    <link rel="prev" title="Release process" href="releases.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="vagrant">
<h1>Vagrant<a class="headerlink" href="#vagrant" title="Permalink to this heading">¶</a></h1>
<p><a class="reference external" href="https://www.vagrantup.com">Vagrant</a> allows contributors to get quickly up and running with a Bodhi development environment by
automatically configuring a virtual machine. Before you get started, ensure that your host machine
has virtualization extensions enabled in its BIOS so the guest is not slow. To
get started, simply use these commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo dnf install ansible libvirt vagrant-libvirt vagrant-sshfs vagrant-hostmanager
$ sudo systemctl enable libvirtd
$ sudo systemctl start libvirtd
</pre></div>
</div>
<p>As of 2022, bodhi now uses OpenID Connect (OIDC) for authentication. For the vagrant development environment,
this requires a running FreeIPA and Ipsilon instance. Running tinystage
(<a class="reference external" href="https://github.com/fedora-infra/tiny-stage">https://github.com/fedora-infra/tiny-stage</a>) will set these up. Ensure that tinystage is running before trying
to provision bodhi with vagrant. To set up tinystage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/fedora-infra/tiny-stage
$ pushd tiny-stage/
    $ vagrant up
    $ popd
</pre></div>
</div>
<p>Next, check out the bodhi code and run <code class="docutils literal notranslate"><span class="pre">vagrant</span> <span class="pre">up</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/fedora-infra/bodhi
$ cd bodhi
$ vagrant up
</pre></div>
</div>
<p>Your newly provisioned bodhi development instance is now available at <a class="reference external" href="https://bodhi-dev.example.com/">https://bodhi-dev.example.com/</a>.</p>
<p>The Vagrant guest runs an AMQP message broker (RabbitMQ) which has a web interface for monitoring and
administration of the Fedora Messaging queue at <a class="reference external" href="http://bodhi-dev.example.com:15672/">http://bodhi-dev.example.com:15672/</a>. The default username
is <code class="docutils literal notranslate"><span class="pre">guest</span></code> and the password is <code class="docutils literal notranslate"><span class="pre">guest</span></code>.</p>
<section id="authentication">
<h2>Authentication<a class="headerlink" href="#authentication" title="Permalink to this heading">¶</a></h2>
<p>The Vagrant environment will configure Bodhi server and Bodhi’s CLI to use the tiny-stage Ipsilon
(<a class="reference external" href="https://ipsilon.tinystage.test">https://ipsilon.tinystage.test</a>) for authentication. The users are defined in the tiny-stage FreeIPA
instance (<a class="reference external" href="https://ipa.tinystage.test">https://ipa.tinystage.test</a>). There are many test users defined by default in the tinystage
FreeIPA instance, and the admin user is <code class="docutils literal notranslate"><span class="pre">admin</span></code> with a password <code class="docutils literal notranslate"><span class="pre">password</span></code>.</p>
<p>During the Vagrant provisioning, two users are automatically added to the tinystage instance specifically
for enabling you to test Bodhi: <code class="docutils literal notranslate"><span class="pre">tinystage_packager</span></code> and <code class="docutils literal notranslate"><span class="pre">tinystage_provenpackager</span></code>, both with
password <code class="docutils literal notranslate"><span class="pre">password</span></code>. If you want to login with your username (or any username of your choice), just
edit the <code class="docutils literal notranslate"><span class="pre">fas_username</span></code> variable in the Vagrantfile and re-provision the VM. Be advised that this will
not be a copy of your real fas account, it will just have the same username with the default password
<code class="docutils literal notranslate"><span class="pre">password</span></code> and fake complementary data.</p>
</section>
<section id="quick-tips-about-the-bodhi-vagrant-environment">
<h2>Quick tips about the Bodhi Vagrant environment<a class="headerlink" href="#quick-tips-about-the-bodhi-vagrant-environment" title="Permalink to this heading">¶</a></h2>
<p>You can ssh into your running Vagrant box like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Make sure your bodhi checkout is your shell&#39;s cwd
$ vagrant ssh
</pre></div>
</div>
<p>Once you are inside the development environment, there are a helpful set of commands in your
<code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> that will be printed to the screen via the <code class="docutils literal notranslate"><span class="pre">/etc/motd</span></code> file. Be sure to familiarize
yourself with these:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
Welcome to the Bodhi development environment! Here are some helpful commands:

bci:         Run the Bodhi CI test suite.
bdocs:       Build Bodhi&#39;s documentation.
bfedmsg:     Display the log of Bodhi&#39;s messages on the bus.
blog:        View Bodhi&#39;s log. (Support all the systemctl options, such as -lf)
bresetdb:    Drop and reimport the database.
brestart:    Restart the Bodhi service.
bodhi-shell: Get a handy python shell initialized with Bodhi models.
bstart:      Start the Bodhi service.
bstop:       Stop the Bodhi service.
btest:       Run Bodhi&#39;s test suite.
blint:       Run a series of linter checks.
bstartdeps:  Create and Run WaiverDB and Greenwave docker services
bstopdeps:   Stop WaiverDB and Greenwave docker services
bremovedeps: Destroy WaiverDB and Greenwave docker services


The BODHI_URL environment variable is set to https://bodhi-dev.example.com/
so the bodhi client will use the local development server.

Happy hacking!
</pre></div>
</div>
<p>Keep in mind that all <code class="docutils literal notranslate"><span class="pre">vagrant</span></code> commands should be run with your current working directory set to
your Bodhi checkout. The code from your development host will be mounted in <code class="docutils literal notranslate"><span class="pre">/home/vagrant/bodhi</span></code>
in the guest. You can edit this code on the host, and the vagrant-sshfs plugin will cause the
changes to automatically be reflected in the guest’s <code class="docutils literal notranslate"><span class="pre">/home/vagrant/bodhi</span></code> folder.</p>
<p>The development server is run inside the Vagrant environment by the <code class="docutils literal notranslate"><span class="pre">bodhi.service</span></code> systemd unit.
You can use <code class="docutils literal notranslate"><span class="pre">bodhi-shell</span></code> to get a Python shell quickly set up with a nice environment for you to hack
in. Here’s an example where we use <code class="docutils literal notranslate"><span class="pre">bodhi-shell</span></code> to set an update’s request to stable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[vagrant@bodhi-dev bodhi]$ bodhi-shell
2017-11-02 21:08:56,359 INFO  [bodhi][MainThread] Using the FakeBugTracker
2017-11-02 21:08:56,359 DEBUG [bodhi][MainThread] Using DevBuildsys
Python 2.7.13 (default, May 10 2017, 20:04:28)
Type &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.

IPython 3.2.1 -- An enhanced Interactive Python.
?         -&gt; Introduction and overview of IPython&#39;s features.
%quickref -&gt; Quick reference.
help      -&gt; Python&#39;s own help system.
object?   -&gt; Details about &#39;object&#39;, use &#39;object??&#39; for extra details.

Environment:
  app          The WSGI application.
  registry     Active Pyramid registry.
  request      Active request object.
  root         Root of the default resource tree.
  root_factory Default root factory used to create `root`.

Custom Variables:
  m            bodhi.server.models
  s            bodhi.server.Session

In [1]: u = m.Update.query.filter_by(alias=&#39;FEDORA-2016-840ff89708&#39;).one()

In [2]: u.request = m.UpdateRequest.stable

In [3]: s().commit()
</pre></div>
</div>
<p>When you are done with your Vagrant guest, you can destroy it permanently by running this command on
the host:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ vagrant destroy
</pre></div>
</div>
<p>If you wish to use a custom <code class="docutils literal notranslate"><span class="pre">Vagrantfile</span></code>, you can set the environment variable
<code class="docutils literal notranslate"><span class="pre">VAGRANT_VAGRANTFILE</span></code> as a path to a script.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo.svg" alt="Logo"/>
    
    <h1 class="logo logo-name">bodhi</h1>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=fedora-infra&repo=bodhi&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/testing.html">Testing updates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/update_states.html">Update states</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/buildroot_overrides.html">Buildroot Overrides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/automatic_updates.html">Automatic Updates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/fedora-flavored-markdown.html">Fedora-Flavored Markdown</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/release_notes.html">Release notes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../server_api/index.html">Bodhi Server APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python_bindings.html">Python bindings</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Developer documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Release process</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Vagrant</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#authentication">Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="#quick-tips-about-the-bodhi-vagrant-environment">Quick tips about the Bodhi Vagrant environment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="vagrant_vscode.html">Debugging with Visual Studio Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="virtualenv.html">Virtualenv</a></li>
<li class="toctree-l1"><a class="reference internal" href="models.html">Database models</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../administration.html">Administration</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="releases.html" title="previous chapter">Release process</a></li>
      <li>Next: <a href="vagrant_vscode.html" title="next chapter">Debugging with Visual Studio Code</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2007-2023, Red Hat, Inc..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 6.1.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../_sources/developer/vagrant.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>